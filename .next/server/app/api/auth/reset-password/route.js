(()=>{var e={};e.id=6478,e.ids=[6478],e.modules={1678:(e,r,t)=>{"use strict";t.d(r,{db:()=>i});let s=require("@prisma/client"),i=global.prisma||new s.PrismaClient({log:["query"]})},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8054:(e,r,t)=>{"use strict";t.d(r,{A$:()=>d,J1:()=>c,kH:()=>u,xw:()=>p});var s=t(49526),i=t(1678),o=t(55511);let n=s.createTransport({host:process.env.SMTP_HOST,port:Number(process.env.SMTP_PORT),secure:"true"===process.env.SMTP_SECURE,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASSWORD}});function a(){return(0,o.randomBytes)(32).toString("hex")}async function u(e,r){let t=a(),s=new Date(Date.now()+864e5);await i.db.verificationToken.create({data:{userId:e,token:t,expires:s}});let o=`${process.env.NEXTAUTH_URL}/auth/verify?token=${t}`;await n.sendMail({from:process.env.SMTP_FROM,to:r,subject:"Verify your email address",html:`
      <h1>Email Verification</h1>
      <p>Click the link below to verify your email address:</p>
      <a href="${o}">${o}</a>
      <p>This link will expire in 24 hours.</p>
    `})}async function c(e){let r=await i.db.user.findUnique({where:{email:e}});if(!r)return;let t=a(),s=new Date(Date.now()+36e5);await i.db.resetToken.create({data:{userId:r.id,token:t,expires:s}});let o=`${process.env.NEXTAUTH_URL}/auth/reset-password?token=${t}`;await n.sendMail({from:process.env.SMTP_FROM,to:e,subject:"Reset your password",html:`
      <h1>Password Reset</h1>
      <p>Click the link below to reset your password:</p>
      <a href="${o}">${o}</a>
      <p>This link will expire in 1 hour.</p>
      <p>If you didn't request this, please ignore this email.</p>
    `})}async function p(e,r){let t=await i.db.resetToken.findUnique({where:{token:e},include:{user:!0}});if(!t||t.expires<new Date)throw Error("Invalid or expired reset token");let s=await bcrypt.hash(r,10);await i.db.$transaction([i.db.user.update({where:{id:t.userId},data:{password:s}}),i.db.resetToken.delete({where:{id:t.id}})])}async function d(e){let r=await i.db.verificationToken.findUnique({where:{token:e},include:{user:!0}});if(!r||r.expires<new Date)throw Error("Invalid or expired verification token");await i.db.$transaction([i.db.user.update({where:{id:r.userId},data:{emailVerified:new Date}}),i.db.verificationToken.delete({where:{id:r.id}})])}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},21820:e=>{"use strict";e.exports=require("os")},27172:e=>{"use strict";e.exports=require("cluster")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},35098:(e,r,t)=>{"use strict";t.d(r,{Eb:()=>f,xC:()=>x,Qj:()=>w});var s=t(55729),i=t(70300),o=t.n(i);let n=process.env.REDIS_URL,a=process.env.REDIS_HOST,u=parseInt(process.env.REDIS_PORT||"6379"),c=process.env.REDIS_PASSWORD,p="true"===process.env.REDIS_TLS,d=global.redis||function(){try{if(n)return new(o())(n,{maxRetriesPerRequest:3,lazyConnect:!0,tls:p?{}:void 0});if(a)return new(o())({host:a,port:u,password:c,maxRetriesPerRequest:3,lazyConnect:!0,tls:p?{}:void 0,family:4,keepAlive:3e4,connectTimeout:1e4});return new(o())("redis://localhost:6379",{maxRetriesPerRequest:3,lazyConnect:!0})}catch(e){throw console.error("Failed to create Redis client:",e),e}}();function l(e){try{return new s.RateLimiterRedis({storeClient:d,...e})}catch(r){return console.warn("Failed to create Redis rate limiter, falling back to memory:",r),new s.RateLimiterMemory(e)}}d.on("error",e=>{console.error("Redis connection error:",e)}),d.on("connect",()=>{console.log("✅ Redis connected successfully")}),d.on("ready",()=>{console.log("✅ Redis ready for commands")}),d.on("close",()=>{console.warn("⚠️ Redis connection closed")}),l({keyPrefix:"rl_auth",points:3,duration:900,blockDuration:900}),l({keyPrefix:"rl_email",points:2,duration:3600,blockDuration:3600});let w=l({keyPrefix:"rl_reset",points:2,duration:3600,blockDuration:3600});l({keyPrefix:"rl_2fa",points:3,duration:900,blockDuration:900});let x=l({keyPrefix:"rl_api",points:10,duration:60,blockDuration:60});async function f(e,r){try{let t=await e.consume(r);return{success:!0,limit:e.points,remaining:t.remainingPoints}}catch(r){return{success:!1,limit:e.points,remaining:0,retryAfter:Math.ceil(r.msBeforeNext/1e3)}}}},37366:e=>{"use strict";e.exports=require("dns")},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},62577:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>d,serverHooks:()=>x,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{POST:()=>p});var i=t(96559),o=t(48088),n=t(37719),a=t(32190),u=t(8054),c=t(35098);async function p(e){try{let{action:r,email:t,token:s,password:i}=await e.json(),o=e.headers.get("x-forwarded-for")||"127.0.0.1";switch(r){case"request":if(!t)return a.NextResponse.json({error:"Email required"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return a.NextResponse.json({error:"Invalid email format"},{status:400});let n=await (0,c.Eb)(c.Qj,`${o}:${t}`);if(!n.success)return a.NextResponse.json({error:"Too many requests"},{status:429,headers:{"Retry-After":n.retryAfter?.toString()||"60"}});return await (0,u.J1)(t),a.NextResponse.json({success:!0});case"reset":if(!s||!i)return new a.NextResponse("Token and password required",{status:400});return await (0,u.xw)(s,i),a.NextResponse.json({success:!0});default:return new a.NextResponse("Invalid action",{status:400})}}catch(e){if(console.error("Password reset error:",e),e instanceof Error)return new a.NextResponse(e.message,{status:400});return new a.NextResponse("Internal error",{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/reset-password/route",pathname:"/api/auth/reset-password",filename:"route",bundlePath:"app/api/auth/reset-password/route"},resolvedPagePath:"C:\\Users\\Awais\\Downloads\\workspace-af655d45-ec8c-4874-bfd0-23615092e71d (3)\\src\\app\\api\\auth\\reset-password\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:w,serverHooks:x}=d;function f(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:w})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719,580,9526,300,5729],()=>t(62577));module.exports=s})();